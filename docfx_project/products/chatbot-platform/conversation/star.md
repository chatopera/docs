## 通配符

为了让**匹配器**能适应复杂的需求，Chatopera 机器人平台使用通配符规则，通配符既能让规则具有更好的匹配能力，也能让回复和函数中使用不同通配符的值。

**注意**：下面的某些通配符左右带有空格，这些空格是必须的。

## 全能匹配

全能匹配通配符会匹配零到无穷个字符、单词。

<font color="blue"><b>(\*)</b></font>

此处的输入也会被系统捕获或者存储。

```
+ (*) 你好 (*)
- 欢迎光临
```

```
匹配：客服你好
匹配：你好
匹配：你好吗
```

## 固定长度通配符

如果你知道你想要的字符长度，使用固定长度通配符。

<font color="blue"><b>\*n</b></font>

其中 n 代表长度。

此处的通配符可以被系统捕获，而且可以在回答中使用。

```
+ 早安 *2
- 早安
```

```
匹配：早安北京
不匹配：早安乌鲁木齐
```

## 可变长度通配符

<font color="blue"><b>\*~n</b></font>

如果只想匹配一些字符，可控长度的通配符是个不错的选择。 n 代表你想匹配的最大长度。

```
+ 早安 *~4
- 早安
```

```
匹配：早安
匹配：早安北京
匹配：早安哈尔滨
匹配：早安乌鲁木齐
不匹配：早安君士坦丁堡
```

## 区间通配符

如果想匹配一个确定的区间，比如 2 到 4 个字符之间，区间通配符绝对可以满足需要。

<font color="blue"><b>\*(最短-最长)</b></font>

此通配符可以被系统捕获和用在回复中。

```
+ 早安 *(2-4)
- 早安
```

```
匹配：早安北京
匹配：早安乌鲁木齐
不匹配：早安
```

## 必选项

必选项用在你有一系列可选项，但是必须有一个被匹配。

<font color="blue"><b>(候选-1|候选-2|...|候选-n)</b></font>

输入中的可选项会被系统捕获和用在回复中。

```
+ 早安(北京|上海|天津)
- 早安
```

```
匹配：早安北京
不匹配：早安西安
不匹配：早安
```

## 可选项

可选项用来确定一些额外的内容。

<font color="blue"><b>[可能值-1|可能值-2]</b></font>

```
+ 早安 [美丽的] 北京
- 早安
```

**注意：此处 `[]` 前后的空格不可省略。**

```
匹配：早安北京
匹配：早安美丽的北京
不匹配：早安热闹的北京
```

## 回复

在**匹配器**中，我们已经学到了怎么添加一个回答。事实上你可以添加任意数量的回答。这里还有一些高级功能可以帮助你完成更多的任务。

## 简单形式

```
+ 在吗
- 你好，在的
```

如果添加了多个回答，系统会从中随机挑选一个作为回复, 然后丢掉这个回答。

```
+ 在吗
- 亲，在的
- 亲，有什么需要帮助
- 你好，请问遇到什么问题了吗？
```

所谓丢掉这个答案，是指机器人针对同一个用户，在半个小时内再次匹配上该**匹配器**时，选择回复时，不考虑使用过的回复。
在一个**匹配器**中声明多个回复后，保存，**逻辑**中将出现分支。

<table class="image">
<caption align="bottom">机器人对话逻辑</caption>
<tr><td><img width="800" src="../../../images/products/cde/cde-16.png" alt="机器人对话逻辑"/></td></tr>
</table>

如果不想让系统丢掉使用过的回复，可以在回复前添加{keep}。

```
+ 在吗
- {keep} 亲，在的
- 亲，有什么需要帮助
- 你好，请问遇到什么问题了吗？
```

也可以在匹配器前添加*{keep}*，就不用在每个回答中都添加了

```
+ {keep} 在吗
- 亲，在的
- 亲，有什么需要帮助
- 你好，请问遇到什么问题了吗？
```

如果回答很长，可以通过“^”分割以方便可读性。可以通过“\n”实现换行

```
+ 在吗
- 你好，这里是客服中心，\n
^ 请问遇到什么问题了吗？
```

它等价于

```
+ 在吗
- 你好，这里是客服中心，请问遇到什么问题了吗？
```

## 上下文钩子

在实际应用中，和机器人聊天时，很可能要通过**上下文钩子**完成一个任务。我们用(**%**)来定位之前回复，声明新的匹配器，(**%**)后的内容是和某个回复内容一样的字符串，这里的(**%**)称之为“上下文钩子”。

```
+ (*)
- 您身高多少

  + *(3-5)
  % 您身高多少
  - 我的身高也是<cap1>
```

让我们一起看看这个例子：

1. 当用户输入任何文字，我们用通用通配符触发回答，然后系统回复“您身高多少”。

2. 当用户继续输入时，系统会先从历史中查看之前的回复中是否有对应的上下文，在这里指的是“% 您身高多少”

3. 最后，如果用户输入 3 到 5 个字符，系统匹配匹配器“+ \*(3-5)”, 并且回复“我也是&#60;cap&#62;”。“&#60;cap&#62;”代表的就是用户输入的内容。

## 引用回复

有些时候，在问答对中重用一些回复能使编写脚本效率更高，这时可以定义一个问答对，并在脚本其它位置引用它。

```
+ 在吗
- {@__greeting__} 请问有什么能帮助您？

+ __greeting__
- 亲，在的。
- 你好，客服小美为您服务
- 亲亲，稍等，客服马上就到
```

引用的方式就是 `{@匹配器}`，匹配器中的下划线不是必须的，上面例子中的匹配器`__greeting__`的命名是为了增强脚本的可读性。

将一些常用的回复以约定的匹配器命名方式命名，不但方便复用回复，使脚本可读性好，方便维护，而且更方便使用**上下文钩子**实现多轮对话。

```
+ 在吗
- {@__greeting__}

    + (*) 问路 (*)
    % {@__greeting__}
    - 请使用地图APP

    + (*) 打车 (*)
    % {@__greeting__}
    - 出租车在门口挥手示意停车

    + (*)
    % {@__greeting__}
    - {@__greeting__}

+ __greeting__
- 亲，在的。请问有什么能帮助您？
- 你好，客服小美为您服务
- 亲亲，稍等，客服马上就到
```

## 通配符取值

有些时候，在回答中需要使用输入中的通配符值，这时可以使用&#60;cap&#62;达到目的。

```
+ 我是 *~3
- 你好，<cap>
```

```
匹配：小明比小红高
回答：你确定小明比小红高吗？
```

如果用户输入，“我是张三”，那么系统将回复“你好，张三”，当有多个槽时，可以使用多个&#60;cap&#62;。

```
+ *2 比 *2 高
- 你确定<cap1>比<cap2>高吗？
```

在对话中，我们有时候会需要以前的通配符值，看一下下面这个例子：

```
+ 我叫 *~3
- 你好，<cap1>

    + 你猜我叫什么？
    % 你好，<cap1>
    - 你刚说了，你叫<p1cap1>
```

&#60;pNcapM&#62;代表了以前的通配符。其中*N*代表在在对话中之前的问答，*M*代表捕获的位移。

<table class="image">
<caption align="bottom">通配符取值</caption>
<tr><td><img width="800" src="../../../images/products/cde/cde-16.png" alt="通配符取值"/></td></tr>
</table>

此处，上下文钩子，即`%`开头的句子，代表匹配器“你猜我叫什么？”只服务于“你好，&#60;cap1&#62;”作为回复时，它会被优先匹配。上一轮对话的回复通过(%)的方式指定了接下来的逻辑，形成多轮对话。

**提示：+/%/- 前的空格不是必须的，在多轮对话中，空格可以增强脚本的可读性，比如使用上下文钩子中的段首缩进。**

## 评论

<script src="https://utteranc.es/client.js"
        repo="chatopera/docs"
        issue-term="pathname"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
